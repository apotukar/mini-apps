{% from "common/macros/image.njk" import image %}
<br>
<div class="leg">
  <div class="leg-header">
      <strong>
          {% if leg.isWalking %}
          {{ image("walk.min", viewExt, { alt: "üö∂", class: "icon-inline", alt_fallback: "walk", height: 10, border: 0 }) }}
          {% else %}
          {{ image("train.min", viewExt, { alt: "üöÜ", class: "icon-inline", alt_fallback: "train", height: 10, border: 0 }) }}
          {% endif %}
          &nbsp;{{ leg.idx }}: {{ leg.originName }}&nbsp;
          {{ image("rarrow.min", viewExt, { alt: "‚Üí", class: "arrow-inline", alt_fallback: "->", height: 10, border: 0 }) }}
          &nbsp;{{ leg.destName }}&nbsp;
      </strong>
  </div>
  <div class="leg-main">
    {# Abfahrt #}
    <div class="leg-row">
      <span class="label">Ab:</span>
      <span class="value">
        <strong>
        {{ leg.depPlannedTime | formatTime }}
        {% if leg.depDelayMin > 0 %}
        <span class="delay">
            +{{ leg.depDelayMin | formatDuration}}
            {{ image("rarrowred.min", viewExt, { alt: "‚Üí", class: "arrow-inline", alt_fallback: "->", height: 10, border: 0 }) }}
            {{ leg.depTime | formatTime }}</span>
        {% endif %}
        </strong>
        {% if leg.depPlatform %}
          , Gleis {{ leg.depPlatform }}
          {% if leg.depPlatformPlanned and leg.depPlatformPlanned != leg.depPlatform %}
            <span class="platform-change">(geplant: {{ leg.depPlatformPlanned }})</span>
          {% endif %}
        {% endif %}
      </span>
    </div>

    {# Ankunft #}
    <div class="leg-row">
      <span class="label">An:</span>
      <span class="value">
        <strong>
        {{ leg.arrPlannedTime | formatTime }}
        {% if leg.arrDelayMin > 0 %}
        <span class="delay">
            +{{ leg.arrDelayMin | formatDuration}}
            {{ image("rarrowred.min", viewExt, { alt: "‚Üí", class: "arrow-inline", alt_fallback: "->", height: 10, border: 0 }) }}
            {{ leg.arrTime | formatTime }}</span>
        {% endif %}
        </strong>
        {% if leg.arrPlatform %}
          , Gleis {{ leg.arrPlatform }}
          {% if leg.arrPlatformPlanned and leg.arrPlatformPlanned != leg.arrPlatform %}
            <span class="platform-change">(geplant: {{ leg.arrPlatformPlanned }})</span>
          {% endif %}
        {% endif %}
      </span>
    </div>

    {# Linie / Produkt / Richtung #}
    {% if not leg.isWalking %}
      {% if leg.lineText %}
        <div class="leg-row">
          <span class="label">Linie:</span>
          <span class="value">{{ leg.lineText }}</span>
        </div>
      {% endif %}

      {% if leg.direction %}
        <div class="leg-row">
          <span class="label">Richtung:</span>
          <span class="value">{{ leg.direction }}</span>
        </div>
      {% endif %}

      {% if leg.loadFactor %}
        <div class="leg-row">
          <span class="label">Auslastung:</span>
          <span class="value">{{ leg.loadFactor }}</span>
        </div>
      {% endif %}
    {% else %}
      <div class="leg-row">
        <span class="label">Art:</span>
        <span class="value">Fu√üweg</span>
      </div>
    {% endif %}

    {# Statusmeldungen #}
    {% if leg.statusRemarks and leg.statusRemarks.length %}
      <div class="leg-row leg-status">
        <span class="label">Status:</span>
        <span class="value">
          {% for s in leg.statusRemarks %}
            <div class="status-item">
                {{ image("warn.min", viewExt, { alt: "‚ö†", class: "icon-inline", alt_fallback: "warn", height: 10, border: 0 }) }} {{ s }}
            </div>
          {% endfor %}
        </span>
      </div>
    {% endif %}

    {# Hinweise #}
    {% if leg.hintRemarks and leg.hintRemarks.length %}
      <div class="leg-row leg-hints">
        <span class="label">Hinweise:</span>
        <span class="value">
          {% for h in leg.hintRemarks %}
            <div class="hint-item">
                {{ image("info.min", viewExt, { alt: "‚Ñπ", class: "icon-inline", alt_fallback: "info", height: 10, border: 0 }) }} {{ h }}
            </div>
          {% endfor %}
        </span>
      </div>
    {% endif %}
  </div>

</div>
